<div class="relative">
  <!-- Bell Button -->
  <button
    class="relative p-2 cursor-pointer bg-gray-300 rounded-xl hover:bg-gray-400 transition"
    (click)="toggle()"
  >
    <lucide-angular [img]="Bell" class="w-5 h-5" />

    <span
      *ngIf="unreadCount > 0"
      class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1"
    >
      {{ unreadCount }}
    </span>
  </button>

  <!-- Popover -->
  <div
    *ngIf="open"
    class="absolute right-0 mt-2 w-96 bg-white border border-gray-200 rounded-xl shadow-lg z-50"
  >
    <!-- Header -->
    <div class="flex justify-between items-center p-4 border-b border-gray-300">
      <div>
        <h3 class="font-semibold text-gray-800">ការជូនដំណឹង</h3>
        <p class="text-xs text-gray-500">
          មិនទាន់អាន {{ unreadCount }} សារ
        </p>
      </div>

      <button
        *ngIf="unreadCount > 0"
        class="flex items-center cursor-pointer gap-1 text-xs text-blue-600 hover:underline"
        (click)="markAllAsRead()"
      >
        <lucide-angular [img]="Check" class="w-3 h-3" />
        សម្គាល់ទាំងអស់
      </button>
    </div>

    <!-- List -->
    <div class="max-h-80 overflow-y-auto divide-y divide-gray-300">
      <div
        *ngFor="let n of notifications"
        class="p-4 flex gap-3 cursor-pointer hover:bg-gray-100"
        [class.bg-blue-50]="!n.read"
        (click)="markAsRead(n.id)"
      >
        <!-- Icon -->
        <div
          class="w-9 h-9 rounded-full flex items-center justify-center"
          [ngClass]="getIconBg(n.type)"
        >
          <lucide-angular [img]="getIcon(n.type)" class="w-4 h-4" />
        </div>

        <!-- Content -->
        <div class="flex-1 min-w-0">
          <p
            class="text-sm font-medium truncate"
            [class.text-gray-900]="!n.read"
            [class.text-gray-500]="n.read"
          >
            {{ n.title }}
          </p>

          <p class="text-xs text-gray-500 mt-1 line-clamp-2">
            {{ n.description }}
          </p>

          <p class="text-xs text-gray-400 mt-1">
            {{ n.time }}
          </p>
        </div>

        <!-- Delete -->
        <button
          class="p-1 text-gray-400 hover:text-red-500"
          (click)="deleteNotification(n.id); $event.stopPropagation()"
        >
          <lucide-angular [img]="Trash2" class="w-4 h-4" />
        </button>

        <!-- Unread Dot -->
        <div
          *ngIf="!n.read"
          class="w-2 h-2 bg-blue-600 rounded-full mt-2"
        ></div>
      </div>
    </div>

    <!-- Footer -->
    <div class="p-3 border-t border-gray-300">
      <button
        class="w-full cursor-pointer text-sm text-blue-600 hover:bg-gray-100 py-2 rounded-md"
      >
        មើលការជូនដំណឹងទាំងអស់
      </button>
    </div>
  </div>
</div>
